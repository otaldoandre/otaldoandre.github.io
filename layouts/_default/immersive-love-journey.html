{{- define "main" }}

<style>
    body {
        transition: background 2s ease;
        position: relative;
        min-height: 100vh;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        z-index: -2;
        transition: opacity 2s ease;
    }

    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        transition: background 2s ease;
    }

    body.part-one::before {
        background-image: url('/images/dark-evangelion.png');
        opacity: 0.4;
    }

    body.part-one::after {
        background: linear-gradient(to bottom, 
            rgba(20, 20, 30, 0.95) 0%, 
            rgba(30, 20, 40, 0.92) 50%, 
            rgba(20, 20, 30, 0.95) 100%);
    }

    body.part-two::before {
        background-image: url('/images/light-landscape.png');
        opacity: 0.3;
    }

    body.part-two::after {
        background: linear-gradient(to bottom, 
            rgba(255, 250, 240, 0.92) 0%, 
            rgba(255, 245, 235, 0.90) 50%, 
            rgba(250, 240, 230, 0.92) 100%);
    }

    .post-single {
        position: relative;
        z-index: 1;
    }

    .post-header h1 {
        transition: color 2s ease;
        font-weight: 700;
        text-align: center;
    }

    body.part-one .post-header h1 {
        color: #e8e0f0 !important;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    body.part-two .post-header h1 {
        color: #2d2520 !important;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
    }

    .journey-section {
        margin: 80px 0;
        padding: 40px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        transition: all 1.5s ease;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    body.part-one .journey-section {
        background: rgba(25, 20, 35, 0.85);
        color: #e8e0f0;
        border: 1px solid rgba(150, 130, 180, 0.3);
    }

    body.part-two .journey-section {
        background: rgba(255, 255, 255, 0.9);
        color: #2d2520;
        border: 1px solid rgba(200, 150, 100, 0.3);
    }

    .journey-section h2 {
        font-size: 2em;
        margin-bottom: 1em;
        margin-top: 0.5em;
        transition: color 2s ease;
        font-weight: 600;
    }

    body.part-one .journey-section h2 {
        color: #c4b0e0;
        border-bottom: 2px solid rgba(150, 130, 180, 0.5);
        padding-bottom: 0.3em;
    }

    body.part-two .journey-section h2 {
        color: #d67840;
        border-bottom: 2px solid rgba(200, 150, 100, 0.5);
        padding-bottom: 0.3em;
    }

    .journey-section p {
        margin-bottom: 1.5em;
        font-size: 1.1em;
        text-align: justify;
        line-height: 1.9;
    }

    body.part-one .journey-section p {
        color: #ddd5e5;
    }

    body.part-two .journey-section p {
        color: #3a3530;
    }

    .audio-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 20px;
        border-radius: 30px;
        color: white;
        font-size: 0.9em;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        z-index: 100;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .audio-controls:hover {
        background: rgba(0, 0, 0, 0.85);
    }

    .volume-control {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .volume-slider {
        width: 80px;
        cursor: pointer;
    }

    .mute-btn {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.2em;
        padding: 5px;
        display: flex;
        align-items: center;
    }

    @media (max-width: 768px) {
        .journey-section {
            padding: 25px;
            margin: 50px 0;
        }
        
        .journey-section p {
            font-size: 1em;
        }

        .audio-controls {
            bottom: 10px;
            right: 10px;
            padding: 10px 15px;
        }
    }
</style>

<article class="post-single">
    <header class="post-header">
        {{ partial "breadcrumbs.html" . }}
        <h1 class="post-title entry-hint-parent">
            {{ .Title }}
            {{- if .Draft }}
            <span class="entry-hint" title="Draft">
                <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
                    <path d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
                </svg>
            </span>
            {{- end }}
        </h1>
        {{- if .Description }}
        <div class="post-description">
            {{ .Description }}
        </div>
        {{- end }}
        {{- if not (.Param "hideMeta") }}
        <div class="post-meta">
            {{- partial "post_meta.html" . -}}
            {{- partial "translation_list.html" . -}}
            {{- partial "edit_post.html" . -}}
            {{- partial "post_canonical.html" . -}}
        </div>
        {{- end }}
    </header>

    {{- $isHidden := (.Param "cover.hiddenInSingle") | default (.Param "cover.hidden") | default false }}
    {{- partial "cover.html" (dict "cxt" . "IsSingle" true "isHidden" $isHidden) }}
    {{- if (.Param "ShowToc") }}
    {{- partial "toc.html" . }}
    {{- end }}

    {{- if .Content }}
    <div class="post-content">
        {{- if not (.Param "disableAnchoredHeadings") }}
        {{- partial "anchored_headings.html" .Content -}}
        {{- else }}{{ .Content }}{{ end }}
    </div>
    {{- end }}

    <br>
    {{- $tags := .Language.Params.Taxonomies.tag | default "tags" }}
    <ul class="post-tags">
        {{- range ($.GetTerms $tags) }}
        <li><a href="{{ .Permalink }}">{{ .LinkTitle }}</a></li>
        {{- end }}
    </ul>

    {{- partial "extend_footer.html" . -}}

    <footer class="post-footer">
        {{- if (.Param "ShowPostNavLinks") }}
        {{- partial "post_nav_links.html" . }}
        {{- end }}
        {{- if (and site.Params.ShowShareButtons (ne .Params.disableShare true)) }}
        {{- partial "share_icons.html" . -}}
        {{- end }}
    </footer>

    {{- if (.Param "comments") }}
    {{- partial "comments.html" . }}
    {{- end }}
</article>

<div class="audio-controls">
    <button class="mute-btn" id="muteBtn" title="Mute/Unmute">üîä</button>
    <div class="volume-control">
        <span>Volume</span>
        <input type="range" min="0" max="100" value="70" class="volume-slider" id="volumeSlider">
    </div>
</div>

<audio id="audio-part-one" loop preload="auto">
    <source src="/audio/komm-susser-tod.mp3" type="audio/mpeg">
</audio>

<audio id="audio-part-two" loop preload="auto">
    <source src="/audio/love-comes-to-everyone.mp3" type="audio/mpeg">
</audio>

<script>
    const audioPart1 = document.getElementById('audio-part-one');
    const audioPart2 = document.getElementById('audio-part-two');
    const volumeSlider = document.getElementById('volumeSlider');
    const muteBtn = document.getElementById('muteBtn');
    const body = document.body;

    let currentPart = 1;
    let isMuted = false;

    // Configura√ß√£o inicial de volume
    const initialVolume = 0.7;
    audioPart1.volume = initialVolume;
    audioPart2.volume = 0;

    // Fun√ß√£o para crossfade entre m√∫sicas
    function crossfade(fadeOut, fadeIn, duration = 2000) {
        const steps = 50;
        const interval = duration / steps;
        const volumeStep = 1 / steps;
        let currentStep = 0;

        const fadeInterval = setInterval(() => {
            currentStep++;
            
            if (fadeOut.volume > 0) {
                fadeOut.volume = Math.max(0, fadeOut.volume - volumeStep * (volumeSlider.value / 100));
            }
            
            if (fadeIn.volume < (volumeSlider.value / 100)) {
                fadeIn.volume = Math.min(volumeSlider.value / 100, fadeIn.volume + volumeStep * (volumeSlider.value / 100));
            }

            if (currentStep >= steps) {
                clearInterval(fadeInterval);
                fadeOut.pause();
                fadeIn.play();
            }
        }, interval);
    }

    // Detectar em qual parte do post o usu√°rio est√°
    function checkScrollPosition() {
        const partOne = document.getElementById('part-one');
        const partTwo = document.getElementById('part-two');
        
        if (!partOne || !partTwo) {
            console.log('Elementos part-one ou part-two n√£o encontrados!');
            return;
        }

        const scrollPosition = window.scrollY + window.innerHeight / 2;
        const partTwoTop = partTwo.offsetTop;

        if (scrollPosition < partTwoTop && currentPart !== 1) {
            // Transi√ß√£o para parte 1
            console.log('üåô Mudando para Parte 1');
            currentPart = 1;
            body.classList.remove('part-two');
            body.classList.add('part-one');
            
            if (!isMuted) {
                crossfade(audioPart2, audioPart1);
            }
        } else if (scrollPosition >= partTwoTop && currentPart !== 2) {
            // Transi√ß√£o para parte 2
            console.log('‚òÄÔ∏è Mudando para Parte 2');
            currentPart = 2;
            body.classList.remove('part-one');
            body.classList.add('part-two');
            
            if (!isMuted) {
                crossfade(audioPart1, audioPart2);
            }
        }
    }

    // Controle de volume
    volumeSlider.addEventListener('input', (e) => {
        const volume = e.target.value / 100;
        if (currentPart === 1) {
            audioPart1.volume = volume;
        } else {
            audioPart2.volume = volume;
        }
    });

    // Controle de mute
    muteBtn.addEventListener('click', () => {
        isMuted = !isMuted;
        
        if (isMuted) {
            audioPart1.volume = 0;
            audioPart2.volume = 0;
            muteBtn.textContent = 'üîá';
        } else {
            const volume = volumeSlider.value / 100;
            if (currentPart === 1) {
                audioPart1.volume = volume;
            } else {
                audioPart2.volume = volume;
            }
            muteBtn.textContent = 'üîä';
        }
    });

    // Iniciar primeira m√∫sica quando usu√°rio interage com a p√°gina
    let audioStarted = false;
    function startAudio() {
        if (!audioStarted) {
            audioPart1.play().catch(e => console.log('Autoplay prevented:', e));
            audioStarted = true;
            console.log('üéµ √Åudio iniciado');
        }
    }

    // Event listeners
    window.addEventListener('scroll', checkScrollPosition);
    document.addEventListener('click', startAudio, { once: true });
    document.addEventListener('keydown', startAudio, { once: true });

    // Inicializar com parte 1
    body.classList.add('part-one');

    // Check inicial
    setTimeout(checkScrollPosition, 500);
</script>

{{- end }}{{/* end main */}}