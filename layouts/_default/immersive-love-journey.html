{{- define "main" }}

<style>
    /* Reset */
    .immersive-journey {
        position: relative;
        width: 100%;
        overflow-x: hidden;
    }

    body {
        transition: background 3s ease;
        overflow-x: hidden;
    }

    /* Background layers */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        z-index: -2;
        opacity: 0;
        transition: opacity 3s ease;
    }

    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        transition: background 3s ease;
    }

    /* Fases */
    body.phase-prologue::after {
    background-image: url('/images/dark-evangelion.png');
    }

    body.phase-act1::before {
        background-image: url('/images/dark-evangelion.png');
        opacity: 100%;
    }

    body.phase-act1::after {
        background: linear-gradient(to bottom,
            rgba(20, 20, 30, 0.88) 0%,
            rgba(30, 20, 40, 0.85) 50%,
            rgba(20, 20, 30, 0.88) 100%);
    }

    body.phase-reading::before {
        background-image: url('/images/dark-evangelion.png');
        opacity: 1;
    }

    body.phase-reading::after {
        background: linear-gradient(to bottom,
            rgba(25, 25, 35, 0.90) 0%,
            rgba(30, 25, 40, 0.88) 100%);
    }

    body.phase-act2::before {
        background-image: url('/images/light-landscape.png');
        opacity: 0.3;
    }

    body.phase-act2::after {
        background: linear-gradient(to bottom,
            rgba(255, 250, 240, 0.92) 0%,
            rgba(255, 245, 235, 0.90) 50%,
            rgba(250, 240, 230, 0.92) 100%);
    }

    /* Telas de frases */
    .phrase-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 1s ease, visibility 1s ease;
    }

    .phrase-screen.active {
        opacity: 1;
        visibility: visible;
    }

    .phrase-text {
        font-size: 2em;
        max-width: 900px;
        line-height: 1.8;
        text-align: center;
        margin-bottom: 4rem;
        opacity: 0;
        transform: translateY(30px);
        transition: all 1s ease 0.3s;
    }

    .phrase-screen.active .phrase-text {
        opacity: 1;
        transform: translateY(0);
    }

    .phrase-screen.dark .phrase-text {
        color: #e8e0f0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .phrase-screen.light .phrase-text {
        color: #3a3530;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
    }

    .continue-btn {
        padding: 1rem 3rem;
        font-size: 1.1em;
        background: transparent;
        border: 2px solid;
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
        transition: all 0.5s ease 1s;
        letter-spacing: 1px;
    }

    .phrase-screen.active .continue-btn {
        opacity: 1;
    }

    .phrase-screen.dark .continue-btn {
        border-color: #c4b0e0;
        color: #c4b0e0;
    }

    .phrase-screen.dark .continue-btn:hover {
        background: #c4b0e0;
        color: #1a1520;
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(196, 176, 224, 0.4);
    }

    .phrase-screen.light .continue-btn {
        border-color: #d67840;
        color: #d67840;
    }

    .phrase-screen.light .continue-btn:hover {
        background: #d67840;
        color: #fff;
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(214, 120, 64, 0.4);
    }

    /* Se√ß√£o de leitura */
    .reading-section {
        display: none;
        max-width: 800px;
        margin: 0 auto;
        padding: 4rem 2rem;
        position: relative;
        z-index: 1;
    }

    .reading-section.active {
        display: block;
    }

    .reading-section h2 {
        font-size: 2em;
        margin: 3rem 0 1.5rem;
        font-weight: 600;
        color: #c4b0e0;
        border-bottom: 2px solid rgba(150, 130, 180, 0.5);
        padding-bottom: 0.5rem;
    }

    .reading-section p {
        font-size: 1.15em;
        line-height: 1.9;
        margin-bottom: 1.5em;
        color: #ddd5e5;
        text-align: justify;
    }

    .finish-reading-btn {
        display: block;
        margin: 4rem auto;
        padding: 1rem 3rem;
        font-size: 1.1em;
        background: transparent;
        border: 2px solid #c4b0e0;
        color: #c4b0e0;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .finish-reading-btn:hover {
        background: #c4b0e0;
        color: #1a1520;
        transform: scale(1.05);
    }

    /* Ep√≠logo */
    .epilogue-final {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 2rem;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 1s ease, visibility 1s ease;
    }

    .epilogue-final.active {
        opacity: 1;
        visibility: visible;
    }

    .epilogue-message {
        font-size: 1.8em;
        max-width: 700px;
        line-height: 1.8;
        color: #3a3530;
        margin-bottom: 3rem;
        opacity: 0;
        animation: fadeIn 2s ease forwards;
    }

    @keyframes fadeIn {
        to { opacity: 1; }
    }

    .epilogue-actions {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
        justify-content: center;
        opacity: 0;
        animation: fadeIn 2s ease 1s forwards;
    }

    .epilogue-btn {
        padding: 1rem 2.5rem;
        font-size: 1em;
        background: transparent;
        border: 2px solid #d67840;
        color: #d67840;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .epilogue-btn:hover {
        background: #d67840;
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(214, 120, 64, 0.3);
    }

    /* Controles de √°udio */
    .audio-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 20px;
        border-radius: 30px;
        color: white;
        font-size: 0.9em;
        backdrop-filter: blur(10px);
        z-index: 2000;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .volume-control {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .volume-slider {
        width: 80px;
        cursor: pointer;
    }

    .mute-btn {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.2em;
        padding: 5px;
    }

        #myVideo {
  position: fixed;
  right: 0;
  bottom: 0;
  min-width: 100%;
  min-height: 100%;
}


    /* Responsivo */
    @media (max-width: 768px) {
        .phrase-text {
            font-size: 1.4em;
        }

        .reading-section {
            padding: 3rem 1.5rem;
        }

        .reading-section h2 {
            font-size: 1.6em;
        }

        .reading-section p {
            font-size: 1.05em;
        }

    }


</style>

<div class="immersive-journey">
    <!-- PR√ìLOGO -->
    <div class="phrase-screen active dark" id="prologue" data-phase="prologue">
        <div class="phrase-text">{{ .Title }}</div>
        <button class="continue-btn" onclick="nextPhrase()">O que √© amor?</button>
    </div>

    <!-- ATO I - Frases -->
    <div class="phrase-screen dark" data-phase="act1">
        <div class="phrase-text">Era como viver em um sonho que lentamente se dissolvia em pesadelo.</div>
        <button class="continue-btn" onclick="nextPhrase()">√â o que eu quero!!</button>
    </div>

    <div class="phrase-screen dark" data-phase="act1">
        <div class="phrase-text">A paix√£o consome. Ela queima com uma intensidade que confundimos com profundidade.</div>
        <button class="continue-btn" onclick="nextPhrase()">O apego √© o mais importante!</button>
    </div>

    <div class="phrase-screen dark" data-phase="act1">
        <div class="phrase-text">Preenchia os sil√™ncios com expectativas, os vazios com proje√ß√µes.<br>N√£o via a pessoa real.</div>
        <button class="continue-btn" onclick="nextPhrase()">N√≥s nunca vamos nos separar</button>
    </div>

    <div class="phrase-screen dark" data-phase="act1">
        <div class="phrase-text">Havia depend√™ncia disfar√ßada de devo√ß√£o.<br>Eu n√£o amava ‚Äî eu precisava.</div>
        <button class="continue-btn" onclick="nextPhrase()">Eu n√£o aceito ela longe</button>
    </div>

    <div class="phrase-screen dark" data-phase="act1">
        <div class="phrase-text">A paix√£o promete eternidade mas entrega apenas instantes.</div>
        <button class="continue-btn" onclick="nextPhrase()">Talvez tenha algo a mais sobre isso?</button>
    </div>

    <!-- LEITURA COMPLETA -->
    <div class="reading-section" id="readingSection" data-phase="reading">
        {{ .Content }}
        <button class="finish-reading-btn" onclick="nextPhrase()">Finalizar Jornada</button>
    </div>

    <!-- ATO II - Frases finais -->
    <div class="phrase-screen light" data-phase="act2">
        <div class="phrase-text">E ent√£o... algo mudou.</div>
        <button class="continue-btn" onclick="nextPhrase()">Continuar</button>
    </div>

    <div class="phrase-screen light" data-phase="act2">
        <div class="phrase-text">Aprendi que amor n√£o √© a intensidade que nos tira o ch√£o ‚Äî<br>√© a presen√ßa que nos d√° ra√≠zes.</div>
        <button class="continue-btn" onclick="nextPhrase()">Continuar</button>
    </div>

    <div class="phrase-screen light" data-phase="act2">
        <div class="phrase-text">Descobri que amar √© primeiro um verbo<br>que se conjuga na primeira pessoa.</div>
        <button class="continue-btn" onclick="nextPhrase()">Continuar</button>
    </div>

    <div class="phrase-screen light" data-phase="act2">
        <div class="phrase-text">O amor que encontrei tinha paci√™ncia.<br>Tinha espa√ßo para o sil√™ncio sem desconforto.</div>
        <button class="continue-btn" onclick="nextPhrase()">Continuar</button>
    </div>

    <div class="phrase-screen light" data-phase="act2">
        <div class="phrase-text">Aprendi que amar √© tamb√©m deixar ir.<br>√â confiar que o que √© verdadeiro permanece.</div>
        <button class="continue-btn" onclick="nextPhrase()">Finalizar</button>
    </div>

    <!-- EP√çLOGO -->
    <div class="epilogue-final" id="epilogue">
        <div class="epilogue-message">
            Esta √© minha jornada.<br>
            Das cinzas da paix√£o ao florescimento do amor.<br>
            Da ilus√£o √† verdade.<br>
            E continua.
        </div>
        <div class="epilogue-actions">
            <button class="epilogue-btn" onclick="restartJourney()">Reviver a Jornada</button>
            <a href="/" class="epilogue-btn">Explorar Mais</a>
        </div>

        <!-- <video autoplay muted loop id="myVideo"> -->
           <!-- <source src="/videos/shinji-on-the-beach.mp4" type="video/mp4">-->
        <!--</video>-->

    </div>
</div>

<!-- Controles -->
<div class="audio-controls">
    <button class="mute-btn" id="muteBtn">üîä</button>
    <div class="volume-control">
        <span>Volume</span>
        <input type="range" min="0" max="100" value="70" class="volume-slider" id="volumeSlider">
    </div>
</div>

<!-- √Åudios -->
<audio id="audio-act1" loop preload="auto">
    <source src="/audio/komm-susser-tod.mp3" type="audio/mpeg">
</audio>

<audio id="audio-act2" loop preload="auto">
    <source src="/audio/love-comes-to-everyone.mp3" type="audio/mpeg">
</audio>

<script>
(function() {
    const screens = document.querySelectorAll('.phrase-screen, .reading-section, .epilogue-final');
    const audioAct1 = document.getElementById('audio-act1');
    const audioAct2 = document.getElementById('audio-act2');
    const volumeSlider = document.getElementById('volumeSlider');
    const muteBtn = document.getElementById('muteBtn');
    const body = document.body;

    let currentIndex = 0;
    let isMuted = false;
    let audioStarted = false;
    let currentPhase = 'prologue';

    audioAct1.volume = 0.7;
    audioAct2.volume = 0;
    body.classList.add('phase-prologue');

    window.nextPhrase = function() {
        // Ocultar tela atual
        screens[currentIndex].classList.remove('active');

        // Avan√ßar
        currentIndex++;

        if (currentIndex >= screens.length) {
            return;
        }

        // Mostrar pr√≥xima tela
        setTimeout(() => {
            screens[currentIndex].classList.add('active');

            // Atualizar fase
            const newPhase = screens[currentIndex].dataset.phase;
            if (newPhase && newPhase !== currentPhase) {
                updatePhase(newPhase);
            }

            // Scroll to top para leitura
            if (screens[currentIndex].classList.contains('reading-section')) {
                window.scrollTo({top: 0, behavior: 'smooth'});
            }
        }, 500);

        // Iniciar √°udio no primeiro continuar
        if (!audioStarted && currentIndex === 1) {
            audioAct1.play().catch(e => console.log('Autoplay:', e));
            audioStarted = true;
        }
    };

    window.restartJourney = function() {
        screens[currentIndex].classList.remove('active');
        currentIndex = 0;
        screens[0].classList.add('active');
        updatePhase('prologue');
        window.scrollTo({top: 0, behavior: 'smooth'});
    };

    function updatePhase(newPhase) {
        if (newPhase === currentPhase) return;

        body.classList.remove(`phase-${currentPhase}`);
        body.classList.add(`phase-${newPhase}`);

        // Transi√ß√£o de m√∫sica
        if (currentPhase === 'act1' && newPhase === 'act2') {
            console.log('üåô ‚Üí ‚òÄÔ∏è Transi√ß√£o musical');
            if (!isMuted) crossfade(audioAct1, audioAct2);
        }

        currentPhase = newPhase;
    }

    function crossfade(fadeOut, fadeIn, duration = 3000) {
        const steps = 60;
        const interval = duration / steps;
        const targetVolume = volumeSlider.value / 100;
        let currentStep = 0;

        const fadeInterval = setInterval(() => {
            currentStep++;
            const progress = currentStep / steps;

            fadeOut.volume = Math.max(0, targetVolume * (1 - progress));
            fadeIn.volume = Math.min(targetVolume, targetVolume * progress);

            if (currentStep >= steps) {
                clearInterval(fadeInterval);
                fadeOut.pause();
                fadeIn.play();
            }
        }, interval);
    }

    // Controles
    volumeSlider.addEventListener('input', (e) => {
        const volume = e.target.value / 100;
        if (currentPhase === 'act1' || currentPhase === 'reading') {
            audioAct1.volume = volume;
        } else {
            audioAct2.volume = volume;
        }
    });

    muteBtn.addEventListener('click', () => {
        isMuted = !isMuted;
        audioAct1.volume = isMuted ? 0 : volumeSlider.value / 100;
        audioAct2.volume = isMuted ? 0 : volumeSlider.value / 100;
        muteBtn.textContent = isMuted ? 'üîá' : 'üîä';
    });
})();
</script>

{{- end }}